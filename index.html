<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Campminder Parent Portal</title>
    <style>
        :root {
            --page-bg: #1A1D2E;
            --sidebar-bg: #121422;
            --card-bg: #242842;
            --border-color: #313657;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A5C5;
            --text-placeholder: #8A8891;
            --accent-primary: #7B42F6;
            --accent-secondary: #B01EFF;
            
            --widget-bg: #090233;
            --header-gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            --user-message-gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            --bot-message-bg: #1D1A3D;
            --input-bg: #1D1A3D;
            --launcher-bg: var(--accent-primary);
            --send-button-bg: var(--accent-primary);
            
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: var(--font-family);
            background-color: var(--page-bg);
            color: var(--text-primary);
            display: grid;
            grid-template-columns: 240px 1fr;
            grid-template-rows: 64px 1fr;
            height: 100vh;
            overflow: hidden;
        }

        .dashboard-header {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .dashboard-header h1 {
            font-size: 1.5rem;
            margin: 0;
        }

        .dashboard-sidebar {
            grid-column: 1 / 2;
            grid-row: 1 / 3;
            background-color: var(--sidebar-bg);
            padding: 1.5rem;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2.5rem;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }

        .sidebar-nav a:hover {
            background-color: var(--card-bg);
            color: var(--text-primary);
        }
        
        .sidebar-nav a.active {
            background: var(--header-gradient);
            color: var(--text-primary);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .dashboard-main {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
            overflow-y: auto;
            padding: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .dashboard-grid .registration-card {
            grid-column: 1 / -1; /* Make this card span full width */
        }

        .dashboard-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .dashboard-card h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }
        
        .dashboard-card p, .dashboard-card ul {
             color: var(--text-secondary);
             line-height: 1.6;
        }
        
        .dashboard-card .button {
            display: inline-block;
            background: var(--header-gradient);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 1rem;
            border: none;
            cursor: pointer;
        }

        /* Chat Widget Styles */

        #chat-launcher {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--launcher-bg);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out, opacity 0.2s ease-in-out;
            z-index: 999;
            overflow: hidden;
        }

        #chat-launcher:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        #chat-launcher:hover:not(:disabled) {
            transform: scale(1.1);
        }

        #chat-launcher.loading #launcher-icon-open,
        #chat-launcher.loading #launcher-icon-close {
            display: none;
        }

        #launcher-spinner {
            display: none;
            width: 28px;
            height: 28px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #FFFFFF;
            border-radius: 50%;
            animation: spinner-rotate 0.8s linear infinite;
        }

        #chat-launcher.loading #launcher-spinner {
            display: block;
        }

        @keyframes spinner-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #chat-launcher svg {
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: absolute;
        }
        
        #launcher-icon-open { transform: rotate(0deg) scale(1); opacity: 1; }
        #launcher-icon-close { transform: rotate(90deg) scale(0); opacity: 0; }
        #chat-widget-container.open ~ #chat-launcher #launcher-icon-open { transform: rotate(-90deg) scale(0); opacity: 0; }
        #chat-widget-container.open ~ #chat-launcher #launcher-icon-close { transform: rotate(0deg) scale(1); opacity: 1; }

        #chat-widget-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 400px;
            max-width: 90vw;
            height: 600px;
            max-height: 80vh;
            background-color: var(--widget-bg);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }
        
        #chat-widget-container.fullscreen {
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            border-radius: 0;
        }

        #chat-widget-container.open {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        header {
            background: var(--header-gradient);
            padding: 16px 20px;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            gap: 16px;
        }
        
        header .header-content { flex-grow: 1; }
        header h1 { font-size: 1.25rem; margin: 0; font-weight: 600; }
        header p { font-size: 0.875rem; margin: 2px 0 0; opacity: 0.9; }

        #chatbot-selector {
            background-color: var(--bot-message-bg);
            border-radius: 18px;
            display: flex;
            padding: 4px;
        }

        .selector-btn {
            background-color: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 6px 14px;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }

        .selector-btn.active {
            background-color: var(--send-button-bg);
            color: var(--text-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header-icons { display: flex; align-items: center; }
        .header-icons button { background: none; border: none; cursor: pointer; padding: 4px; margin-left: 8px; color: var(--text-primary); transition: opacity 0.2s; }
        .header-icons button:hover { opacity: 0.8; }
        #expand-button .icon-shrink { display: none; }
        #chat-widget-container.fullscreen #expand-button .icon-shrink { display: inline; }
        #chat-widget-container.fullscreen #expand-button .icon-expand { display: none; }

        #chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
            word-wrap: break-word;
            font-size: 0.95rem;
        }

        .user-message {
            background-image: var(--user-message-gradient);
            color: var(--text-primary);
            align-self: flex-end;
            border-radius: 18px 18px 4px 18px;
        }
        
        .bot-message {
            background-color: var(--bot-message-bg);
            color: var(--text-secondary);
            align-self: flex-start;
            border-radius: 18px 18px 18px 4px;
        }

        .bot-message p, .bot-message ul, .bot-message h3 { margin: 0; }
        .bot-message > *:not(:first-child) { margin-top: 0.75em; }
        .bot-message h3 { font-size: 1.05rem; font-weight: 600; color: var(--text-primary); }
        .bot-message ul { padding-left: 20px; list-style-position: outside; }
        .bot-message li { padding-left: 5px; margin-bottom: 0.25em; }
        
        @keyframes wave-in {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .thinking { font-style: italic; color: var(--text-placeholder); }
        .thinking span { display: inline-block; opacity: 0; transform: translateY(10px); animation: wave-in 0.35s forwards cubic-bezier(0.25, 0.46, 0.45, 0.94); }

        #suggested-questions {
            padding: 0.75rem 1rem;
            background-color: var(--widget-bg);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        #suggested-questions-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .suggested-question-btn {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 0.9rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1.4;
        }

        .suggested-question-btn:hover {
            background-color: var(--bot-message-bg);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .suggested-question-btn:active {
            transform: translateY(0);
        }

        #input-area {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: var(--widget-bg);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        #message-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 20px;
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            margin-right: 0.75rem;
            transition: box-shadow 0.2s;
        }
        
        #message-input::placeholder { color: var(--text-placeholder); }
        #message-input:focus { box-shadow: 0 0 0 2px rgba(123, 66, 246, 0.4); }

        #send-button {
            background-color: var(--send-button-bg);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #send-button:hover:not(:disabled) { background-color: #8A5BF7; }
        #send-button:disabled { background-color: var(--bot-message-bg); cursor: not-allowed; opacity: 0.6; }

        #chat-container::-webkit-scrollbar { width: 6px; }
        #chat-container::-webkit-scrollbar-track { background: transparent; }
        #chat-container::-webkit-scrollbar-thumb { background-color: var(--bot-message-bg); border-radius: 3px; }

        #citations-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            grid-column: 1 / -1;
        }

        #citations-container h2 {
            font-size: 1.25rem;
            margin: 0 0 0.5rem 0;
        }

        #citations-container p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0 0 1.25rem 0;
        }

        .citations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 1.25rem;
        }

        .citation-card {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            font-size: 0.9rem;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .citation-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(123, 66, 246, 0.2);
        }

        .citation-card-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
        }

        .citation-card-title .citation-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-primary);
            color: var(--text-primary);
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 0.85rem;
            font-weight: 700;
            min-width: 32px;
            flex-shrink: 0;
        }

        .citation-card-content {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 1rem;
            flex-grow: 1;
            white-space: pre-wrap;
            font-size: 0.875rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .citation-card-score {
            font-size: 0.8rem;
            color: var(--text-placeholder);
            font-weight: 500;
            margin-top: auto;
        }

        /* Collapsible Citations Styles */
        .citations-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.5rem 0;
            user-select: none;
        }

        .citations-header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .citations-header h2 {
            margin: 0;
            font-size: 1.25rem;
        }

        .citations-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-primary);
            color: var(--text-primary);
            border-radius: 12px;
            padding: 2px 10px;
            font-size: 0.85rem;
            font-weight: 600;
            min-width: 28px;
        }

        .citations-toggle-icon {
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }

        .citations-toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .citations-content {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            max-height: 0;
            opacity: 0;
        }

        .citations-content.expanded {
            max-height: none;
            opacity: 1;
        }

        .citations-description {
            margin-top: 1rem;
        }


        /* Enhanced touch feedback for all interactive elements */
        @media (hover: none) and (pointer: coarse) {
            /* Touch devices only */
            button:active,
            .suggested-question-btn:active,
            .selector-btn:active,
            .citation-card:active {
                opacity: 0.7;
                transform: scale(0.98);
            }

            #chat-launcher:active {
                transform: scale(1.05);
            }

            .sidebar-nav a:active {
                background-color: var(--input-bg);
            }

            /* Remove hover effects on touch devices */
            button:hover,
            .suggested-question-btn:hover,
            .selector-btn:hover,
            .citation-card:hover {
                transform: none;
            }
        }

        /* ============================================
           MOBILE RESPONSIVE STYLES (< 768px)
           ============================================ */
        @media (max-width: 767px) {
            /* Mobile body layout - single column */
            body {
                display: flex;
                flex-direction: column;
                grid-template-columns: unset;
                grid-template-rows: unset;
            }

            /* Dashboard header - mobile with safe area insets */
            .dashboard-header {
                padding: 1rem;
                padding-top: max(1rem, env(safe-area-inset-top));
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
                height: 60px;
                border-bottom: 1px solid var(--border-color);
                grid-column: unset;
                grid-row: unset;
            }

            .dashboard-header h1 {
                font-size: 1.25rem;
            }

            /* Hide sidebar completely on mobile */
            .dashboard-sidebar {
                display: none;
            }

            /* Dashboard main content - mobile */
            .dashboard-main {
                flex: 1;
                overflow-y: auto;
                padding: 1rem;
                grid-column: unset;
                grid-row: unset;
            }

            /* Dashboard grid - single column on mobile */
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Dashboard cards - optimized for mobile */
            .dashboard-card {
                padding: 1rem;
                border-radius: 12px;
            }

            .dashboard-card h2 {
                font-size: 1rem;
            }

            /* Chat launcher - larger on mobile */
            #chat-launcher {
                width: 56px;
                height: 56px;
                bottom: 16px;
                right: 16px;
            }

            /* Chat widget - full screen on mobile */
            #chat-widget-container {
                bottom: 0;
                right: 0;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
            }

            #chat-widget-container.open {
                border-radius: 0;
            }

            /* Hide launcher when chat is open on mobile */
            #chat-widget-container.open ~ #chat-launcher {
                display: none;
            }

            /* Chat widget header - mobile optimized */
            header {
                padding: 1rem;
                flex-wrap: wrap;
            }

            header h1 {
                font-size: 1.125rem;
            }

            header p {
                font-size: 0.8rem;
            }

            /* Chatbot selector - stack on very small screens */
            #chatbot-selector {
                flex-wrap: wrap;
            }

            /* Chat messages - wider on mobile */
            .message {
                max-width: 90%;
                font-size: 0.9rem;
            }

            /* Input area - optimized for mobile with safe area insets */
            #input-area {
                padding: 0.75rem;
                padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
                padding-left: max(0.75rem, env(safe-area-inset-left));
                padding-right: max(0.75rem, env(safe-area-inset-right));
            }

            #message-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 0.65rem 0.85rem;
            }

            #send-button {
                width: 40px;
                height: 40px;
                min-width: 40px;
                min-height: 40px;
            }

            /* Suggested questions - better mobile spacing */
            #suggested-questions {
                padding: 0.65rem;
            }

            .suggested-question-btn {
                padding: 0.65rem 0.85rem;
                font-size: 0.85rem;
                min-height: 44px; /* Touch target */
            }

            /* Citations - single column on mobile */
            .citations-grid {
                grid-template-columns: 1fr;
            }

            .citation-card {
                padding: 1rem;
            }

            /* Personalization section - mobile optimized */
            #personalization-section {
                margin-top: 1.5rem;
                padding-top: 1.5rem;
            }

            /* Camper cards - stack fields vertically on mobile */
            #campers-container > div {
                padding: 0.85rem;
            }

            #campers-container > div > div {
                grid-template-columns: 1fr !important;
                gap: 0.75rem !important;
                padding-right: 0 !important;
            }

            /* Remove button - better positioned on mobile */
            #campers-container button[title="Remove camper"] {
                top: 0.75rem;
                right: 0.75rem;
                padding: 0.4rem;
            }

            /* Form inputs - larger touch targets */
            select, input, textarea, button {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            #camp-selector {
                font-size: 0.95rem;
                padding: 0.75rem;
            }

            /* Custom instructions - mobile optimized */
            #custom-instructions-input {
                font-size: 0.9rem;
                min-height: 180px;
            }

            /* Buttons - larger touch targets */
            .dashboard-card .button,
            #add-camper-button,
            #save-custom-instructions-button,
            #delete-custom-instructions-button,
            #load-template-button {
                min-height: 44px;
                padding: 0.75rem 1rem;
                font-size: 0.95rem;
            }

            /* Header icons - larger touch targets */
            .header-icons button {
                padding: 0.5rem;
                margin-left: 0.5rem;
            }

            .header-icons button svg {
                width: 22px;
                height: 22px;
            }
        }

        /* ============================================
           TABLET RESPONSIVE STYLES (768px - 1024px)
           ============================================ */
        @media (min-width: 768px) and (max-width: 1024px) {
            body {
                grid-template-columns: 200px 1fr;
            }

            .dashboard-sidebar {
                padding: 1rem;
            }

            .sidebar-logo {
                font-size: 1.1rem;
                margin-bottom: 2rem;
            }

            .dashboard-header {
                padding: 0 1.5rem;
            }

            .dashboard-main {
                padding: 1.5rem;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }

            /* Chat widget - slightly smaller on tablet */
            #chat-widget-container {
                width: 380px;
                max-width: 85vw;
                height: 580px;
                max-height: 75vh;
            }

            /* Messages - slightly wider on tablet */
            .message {
                max-width: 85%;
            }
        }

        /* ============================================
           SMALL MOBILE (< 400px)
           ============================================ */
        @media (max-width: 399px) {
            .dashboard-header h1 {
                font-size: 1.1rem;
            }

            header h1 {
                font-size: 1rem;
            }

            header p {
                font-size: 0.75rem;
            }

            .selector-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            .message {
                font-size: 0.85rem;
                padding: 0.65rem 0.85rem;
            }

            #suggested-questions-label {
                font-size: 0.7rem;
            }
        }

        /* ============================================
           LANDSCAPE MOBILE OPTIMIZATION
           ============================================ */
        @media (max-width: 767px) and (orientation: landscape) {
            #chat-widget-container {
                height: 100vh;
            }

            .dashboard-main {
                padding: 0.75rem;
            }

            #chat-container {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>

    <header class="dashboard-header">
        <h1>Parent AI Handbook</h1>
    </header>

    <aside class="dashboard-sidebar" id="dashboard-sidebar">
        <div class="sidebar-logo">
            <span>Campminder</span>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#" class="active">
                   <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    <span>Parent AI Handbook</span>
                </a></li>
            </ul>
        </nav>
    </aside>

    <main class="dashboard-main">
        <div class="dashboard-grid">
            <div class="dashboard-card registration-card">
                <h2>Configure Demo Data</h2>
                <p>This demo shows how the parent AI handbook can interact with multiple camps and use personal data to provide customized responses.</p>
                <div style="margin-top: 1.5rem;">
                    <label for="camp-selector" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Select a Camp:</label>
                    <select id="camp-selector" style="width: 100%; max-width: 400px; padding: 0.75rem 1rem; border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 1rem; cursor: pointer; outline: none;">
                        <option value="">Loading camps...</option>
                    </select>
                </div>

                <div id="personalization-section" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: none;">
                    <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--text-primary);">Personalize Your Experience</h3>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Add campers and their details to get personalized answers from the parent AI handbook.</p>

                    <div id="segments-loading" style="display: none; padding: 1.5rem; text-align: center;">
                        <div style="display: inline-block; width: 20px; height: 20px; border: 3px solid var(--border-color); border-top-color: var(--accent-primary); border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
                        <p style="margin-top: 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">Loading personalization options...</p>
                    </div>

                    <div id="campers-container" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- Camper cards will be dynamically inserted here -->
                    </div>

                    <button id="add-camper-button" type="button" style="margin-top: 1rem; padding: 0.65rem 1.25rem; border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: background-color 0.2s; font-weight: 500;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Add Another Camper
                    </button>
                </div>

                <div id="custom-instructions-section" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: none;">
                    <button id="custom-instructions-toggle" type="button" style="width: 100%; display: flex; align-items: center; justify-content: space-between; background: none; border: none; padding: 0.5rem 0; cursor: pointer; color: var(--text-primary); text-align: left;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                            <span style="font-size: 0.95rem; font-weight: 500;">Custom Safety Instructions</span>
                            <span id="custom-instructions-indicator" style="display: none; color: #10b981; font-size: 0.85rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            </span>
                        </div>
                        <svg id="custom-instructions-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transition: transform 0.2s;"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>

                    <div id="custom-instructions-content" style="display: none; margin-top: 1rem;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">Add custom rules and safety guidelines that the chatbot must always follow (e.g., allergy policies, emergency contacts).</p>

                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <textarea id="custom-instructions-input" placeholder="Enter custom instructions here...&#10;&#10;Example:&#10;CRITICAL SAFETY RULES:&#10;- For allergy questions, always direct parents to contact the camp nurse at nurse@camp.com&#10;- Never provide medical advice&#10;- Emergency contact: (555) 123-4567"
                                style="width: 100%; min-height: 200px; padding: 0.75rem; border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 0.9rem; font-family: 'Inter', sans-serif; resize: vertical;"></textarea>

                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <button id="save-custom-instructions-button" type="button" style="flex: 1; padding: 0.65rem 1.25rem; border-radius: 8px; background-color: var(--send-button-bg); color: white; border: none; font-size: 0.95rem; cursor: pointer; font-weight: 500; transition: opacity 0.2s;">
                                    Save Instructions
                                </button>
                                <button id="delete-custom-instructions-button" type="button" style="padding: 0.65rem 1rem; border-radius: 8px; background-color: transparent; color: #ef4444; border: 1px solid #ef4444; font-size: 0.85rem; cursor: pointer; transition: background-color 0.2s;">
                                    Delete
                                </button>
                                <button id="load-template-button" type="button" style="padding: 0.65rem 1rem; border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 0.85rem; cursor: pointer; transition: background-color 0.2s;">
                                    Load Template
                                </button>
                            </div>

                            <div id="custom-instructions-save-status" style="display: none; padding: 0.65rem; border-radius: 6px; font-size: 0.85rem; text-align: center;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="citations-container" class="dashboard-card" style="display: none;">
                <!-- Citations will be appended here -->
            </div>
        </div>
    </main>
    
    <div id="chat-widget-container">
        <header>
            <div class="header-content">
                <h1 id="header-title">Parent Handbook</h1>
                <p id="header-subtitle">Ask questions of the parent handbook.</p>
            </div>
            <div class="header-icons">
                 <button id="reset-button" aria-label="Reset conversation">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"></polyline><polyline points="23 20 23 14 17 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path></svg>
                 </button>
                 <button id="expand-button" aria-label="Expand chat">
                    <svg class="icon-expand" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                    <svg class="icon-shrink" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
                 </button>
            </div>
        </header>

        <div id="chat-container">
            <!-- Messages will be appended here -->
        </div>

        <div id="suggested-questions" style="display: none;">
            <!-- Suggested questions will be appended here -->
        </div>

        <form id="input-area">
            <input type="text" id="message-input" placeholder="Ask a question..." autocomplete="off" aria-label="Chat message input">
            <button type="submit" id="send-button" aria-label="Send message">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </form>
    </div>
    
    <button id="chat-launcher" aria-label="Open chat widget">
        <div id="launcher-spinner"></div>
        <svg id="launcher-icon-open" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 640 640" fill="#FFFFFF">
            <path d="M128 192C128 156.7 156.7 128 192 128L448 128C483.3 128 512 156.7 512 192L512 416C512 451.3 483.3 480 448 480L360 480C351.3 480 342.9 482.8 336 488L224 572L224 504C224 490.7 213.3 480 200 480L192 480C156.7 480 128 451.3 128 416L128 192zM192 96C139 96 96 139 96 192L96 256L16 256C7.2 256 0 263.2 0 272C0 280.8 7.2 288 16 288L96 288L96 416C96 469 139 512 192 512L192 580C192 595.5 204.5 608 220 608C226.1 608 232 606 236.8 602.4L355.2 513.6C356.6 512.6 358.3 512 360 512L448 512C501 512 544 469 544 416L544 288L624 288C632.8 288 640 280.8 640 272C640 263.2 632.8 256 624 256L544 256L544 192C544 139 501 96 448 96L192 96zM256 312C269.3 312 280 301.3 280 288C280 274.7 269.3 264 256 264C242.7 264 232 274.7 232 288C232 301.3 242.7 312 256 312zM408 288C408 274.7 397.3 264 384 264C370.7 264 360 274.7 360 288C360 301.3 370.7 312 384 312C397.3 312 408 301.3 408 288zM256 224L384 224C419.3 224 448 252.7 448 288C448 323.3 419.3 352 384 352L256 352C220.7 352 192 323.3 192 288C192 252.7 220.7 224 256 224zM160 288C160 341 203 384 256 384L384 384C437 384 480 341 480 288C480 235 437 192 384 192L256 192C203 192 160 235 160 288z"/>
        </svg>
        <svg id="launcher-icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
    
    <script type="module" src="index.tsx"></script>
</body>
</html>